<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è­·ç†è‡¨åºŠè¨ˆç®—å·¥ä½œç«™ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
            overflow: hidden;
        }

        /* èƒŒæ™¯ç‰¹æ•ˆ */
        .bg-gradient-mesh {
            background: 
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(139, 92, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(16, 185, 129, 0.15) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(245, 158, 11, 0.15) 0px, transparent 50%);
            background-size: 100% 100%;
            position: absolute;
            inset: 0;
            z-index: -1;
        }

        /* å´é‚Šæ¬„ç»ç’ƒè³ªæ„Ÿ */
        .glass-sidebar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* å°èˆªæŒ‰éˆ•æ¨£å¼ */
        .nav-item {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: #3b82f6;
            transform: scaleY(0);
            transition: transform 0.2s ease;
            border-radius: 0 4px 4px 0;
        }
        .nav-item.active {
            background-color: #eff6ff;
            color: #1d4ed8;
            font-weight: 600;
        }
        .nav-item.active::before {
            transform: scaleY(1);
        }

        /* è¼¸å…¥æ¡†ç¾åŒ– */
        .input-group {
            position: relative;
            margin-bottom: 1rem;
        }
        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.5rem;
        }
        .input-modern {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            transition: all 0.2s;
            font-size: 1rem;
            color: #1e293b;
        }
        .input-modern:focus {
            outline: none;
            border-color: #3b82f6;
            background-color: #fff;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        /* çµæœå¡ç‰‡ */
        .result-card {
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            border: 1px solid #fff;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
        }

        /* è‡¨åºŠæç¤ºå€å¡Š */
        .clinical-note {
            background-color: #fffbeb; /* amber-50 */
            border-left: 4px solid #f59e0b; /* amber-500 */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
        }
        .clinical-note h4 {
            color: #b45309; /* amber-700 */
            font-weight: 700;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .clinical-note ul {
            list-style-type: disc;
            padding-left: 1.25rem;
            font-size: 0.875rem;
            color: #78350f; /* amber-900 */
            line-height: 1.6;
        }
        
        /* å±éšªè­¦ç¤ºå€å¡Š */
        .danger-alert {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: none; /* é è¨­éš±è— */
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* éš±è—æ•¸å­—ç®­é ­ */
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        /* è‡ªå®šç¾©æ²è»¸ */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
        
        /* å‹•ç•« */
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-screen flex text-slate-700">

    <!-- èƒŒæ™¯ -->
    <div class="bg-gradient-mesh"></div>

    <!-- å·¦å´å°èˆªæ¬„ (Desktop) -->
    <aside class="w-64 glass-sidebar hidden md:flex flex-col h-full shadow-lg z-20">
        <div class="p-6 border-b border-slate-100">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-blue-300 shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                    </svg>
                </div>
                <div>
                    <h1 class="font-bold text-lg text-slate-800 leading-tight">è­·ç†è¨ˆç®—</h1>
                    <p class="text-xs text-slate-500">Clinical Workstation</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-4 custom-scroll space-y-1 px-3">
            <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-2">è¼¸æ¶²èˆ‡ç›£æ¸¬</p>
            <button onclick="switchTab('io')" id="nav-io" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm active">
                <span class="text-lg">ğŸ’§</span> I/O æ¶²é«”å¹³è¡¡
            </button>
            <button onclick="switchTab('drip')" id="nav-drip" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm">
                <span class="text-lg">ğŸ’‰</span> IV æ»´é€Ÿè¨ˆç®—
            </button>
            <button onclick="switchTab('burn')" id="nav-burn" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm">
                <span class="text-lg">ğŸ”¥</span> ç‡’å‚·è¼¸æ¶²å¾©ç”¦
            </button>
            
            <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-6">é‡ç—‡èˆ‡èº«é«”è©•ä¼°</p>
            <button onclick="switchTab('weight')" id="nav-weight" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm">
                <span class="text-lg">ğŸ’Š</span> é«˜è­¦ç¤ºè—¥ç‰©æ»´æ³¨
            </button>
            <button onclick="switchTab('renal')" id="nav-renal" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm">
                <span class="text-lg">âš–ï¸</span> é«”ä½èˆ‡è…åŠŸèƒ½ (CCr)
            </button>
            <button onclick="switchTab('map')" id="nav-map" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm">
                <span class="text-lg">â¤ï¸</span> å¹³å‡å‹•è„ˆå£“ (MAP)
            </button>

            <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-6">ç”¢ç§‘èˆ‡æª¢é©—</p>
            <button onclick="switchTab('edd')" id="nav-edd" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm">
                <span class="text-lg">ğŸ¤°</span> é ç”¢æœŸè¨ˆç®— (EDD)
            </button>
            <button onclick="switchTab('lab')" id="nav-lab" class="nav-item w-full flex items-center gap-3 px-3 py-3 text-left rounded-lg text-sm">
                <span class="text-lg">ğŸ§ª</span> æ ¡æ­£æ•¸å€¼ (Ca/Na/AG)
            </button>
        </nav>
        
        <div class="p-4 border-t border-slate-100 text-center">
            <p class="text-[10px] text-slate-400">è£½ä½œè€… : è¦ä»è—¥å¸« | æ›´æ–° : 2026/01/02</p>
        </div>
    </aside>

    <!-- ä¸»å…§å®¹å€ -->
    <main class="flex-1 h-full overflow-hidden flex flex-col relative">
        <!-- æ‰‹æ©Ÿç‰ˆé ‚éƒ¨å°èˆª -->
        <div class="md:hidden bg-white/90 backdrop-blur-md p-4 border-b flex justify-between items-center z-30">
            <span class="font-bold text-slate-800">è­·ç†è¨ˆç®—å·¥ä½œç«™</span>
            <select onchange="switchTab(this.value)" class="bg-slate-100 text-sm p-2 rounded-lg border-none outline-none focus:ring-2 focus:ring-blue-500">
                <option value="io">ğŸ’§ I/O æ¶²é«”å¹³è¡¡</option>
                <option value="drip">ğŸ’‰ IV æ»´é€Ÿè¨ˆç®—</option>
                <option value="burn">ğŸ”¥ ç‡’å‚·è¼¸æ¶²</option>
                <option value="weight">ğŸ’Š é«˜è­¦ç¤ºè—¥ç‰©</option>
                <option value="renal">âš–ï¸ é«”ä½èˆ‡è…åŠŸèƒ½</option>
                <option value="map">â¤ï¸ å¹³å‡å‹•è„ˆå£“</option>
                <option value="edd">ğŸ¤° é ç”¢æœŸè¨ˆç®—</option>
                <option value="lab">ğŸ§ª æ ¡æ­£æ•¸å€¼</option>
            </select>
        </div>

        <div class="flex-1 overflow-y-auto p-4 md:p-8 lg:p-12 custom-scroll">
            <div class="max-w-6xl mx-auto w-full">
                
                <!-- 1. I/O æ¶²é«”å¹³è¡¡ -->
                <div id="tab-io" class="tab-content animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">æ¶²é«”å¹³è¡¡ç›£æ¸¬</h2>
                        <p class="text-slate-500">è¨ˆç®— Intake/Output å¹³è¡¡èˆ‡æ¯å°æ™‚å¹³å‡å°¿é‡ (UOP)ã€‚</p>
                    </header>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <!-- è¼¸å…¥å€ -->
                        <div class="lg:col-span-5 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                            <div class="input-group">
                                <label>ç¸½è¼¸å…¥é‡ (Intake)</label>
                                <input type="number" id="io-intake" class="input-modern" placeholder="mL">
                            </div>
                            <div class="input-group">
                                <label>ç¸½è¼¸å‡ºé‡ (Output)</label>
                                <input type="number" id="io-output" class="input-modern" placeholder="mL">
                            </div>
                            <div class="input-group">
                                <label>çµ±è¨ˆæ™‚é–“ (Hours)</label>
                                <input type="number" id="io-hours" class="input-modern" placeholder="å°æ™‚">
                            </div>
                            <button onclick="calculateIO()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-blue-200 mt-2">
                                è¨ˆç®—å¹³è¡¡
                            </button>
                        </div>

                        <!-- çµæœå€ -->
                        <div class="lg:col-span-7 space-y-4">
                            <div class="result-card rounded-2xl p-8 relative overflow-hidden">
                                <div class="relative z-10">
                                    <div class="grid grid-cols-2 gap-8">
                                        <div>
                                            <p class="text-sm font-bold text-slate-400 uppercase">æ¶²é«”å¹³è¡¡ (Balance)</p>
                                            <p id="res-io-balance" class="text-4xl font-bold text-slate-800 mt-1">--</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-slate-400 uppercase">å¹³å‡æ™‚å°¿é‡ (UOP)</p>
                                            <p id="res-io-uop" class="text-4xl font-bold text-slate-800 mt-1">--</p>
                                            <p class="text-xs text-slate-500 mt-1">mL/hr</p>
                                        </div>
                                    </div>
                                    <div class="mt-6 pt-6 border-t border-slate-200">
                                        <p id="res-io-msg" class="flex items-center gap-2 text-slate-600 font-medium">
                                            <span class="w-2 h-2 rounded-full bg-slate-300"></span>
                                            è«‹è¼¸å…¥æ•¸å€¼é–‹å§‹è¨ˆç®—
                                        </p>
                                    </div>
                                </div>
                                <div class="absolute -right-6 -top-6 w-32 h-32 bg-blue-100 rounded-full blur-2xl opacity-60"></div>
                            </div>
                            
                            <!-- è‡¨åºŠå°æç¤º -->
                            <div class="clinical-note">
                                <h4>ğŸ“š è‡¨åºŠåˆ¤è®€èˆ‡æ³¨æ„äº‹é …</h4>
                                <ul>
                                    <li><strong>æˆäººæ­£å¸¸ UOPï¼š</strong> æ‡‰ > 0.5 mL/kg/hr (é€šå¸¸ç´„ 30-50 mL/hr)ã€‚</li>
                                    <li><strong>æ­£å¹³è¡¡éå¤šï¼š</strong> é€£çºŒæ•¸æ—¥æ­£å¹³è¡¡éœ€è©•ä¼°è‚ºæ°´è…« (Crackles)ã€çµ„ç¹”æ°´è…«åŠé«”é‡å¢åŠ æƒ…å½¢ã€‚</li>
                                    <li><strong>å°‘å°¿ (Oliguria)ï¼š</strong> é€£çºŒ 6 å°æ™‚ UOP < 0.5 mL/kg/hr ç‚º AKI é¢¨éšªæŒ‡æ¨™ï¼Œéœ€è©•ä¼°æ˜¯å¦ç‚ºå®¹é‡ä¸è¶³ã€é˜»å¡æˆ–è…å¯¦è³ªæå‚·ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. IV æ»´é€Ÿè¨ˆç®— -->
                <div id="tab-drip" class="tab-content hidden animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">IV æ»´é€Ÿè¨ˆç®—</h2>
                        <p class="text-slate-500">ä¸€èˆ¬è¼¸æ¶²ç®¡è·¯é‡åŠ›æ»´é€Ÿæ›ç®— (gtts/min)ã€‚</p>
                    </header>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div class="lg:col-span-5 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                            <div class="input-group">
                                <label>è¼¸æ¶²ç¸½é‡ (Volume)</label>
                                <input type="number" id="iv-vol" class="input-modern" placeholder="mL">
                            </div>
                            <div class="input-group">
                                <label>é è¨ˆè¼¸æ³¨æ™‚é–“ (Time)</label>
                                <input type="number" id="iv-time" class="input-modern" placeholder="å°æ™‚ (Hr)">
                            </div>
                            <div class="input-group">
                                <label>æ»´ä¿‚æ•¸ (Drop Factor)</label>
                                <select id="iv-factor" class="input-modern cursor-pointer">
                                    <option value="10">10 gtts/mL (ä¸€èˆ¬æˆäºº)</option>
                                    <option value="15">15 gtts/mL (ä¸€èˆ¬æˆäºº)</option>
                                    <option value="20">20 gtts/mL (ç²¾å¯†è¼¸æ¶²)</option>
                                    <option value="60">60 gtts/mL (å°å…’/Micro)</option>
                                </select>
                            </div>
                            <button onclick="calculateDrip()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-indigo-200 mt-2">
                                è¨ˆç®—æ»´é€Ÿ
                            </button>
                        </div>

                        <div class="lg:col-span-7">
                            <div class="result-card rounded-2xl p-10 text-center relative overflow-hidden flex flex-col items-center justify-center min-h-[200px]">
                                <p class="text-sm font-bold text-indigo-400 uppercase tracking-widest mb-2">ç›®æ¨™æ»´é€Ÿ (Target Rate)</p>
                                <p id="res-drip" class="text-6xl font-bold text-slate-800">--</p>
                                <p class="text-lg text-slate-500 mt-2">gtts/min (æ»´/åˆ†)</p>
                                
                                <div class="mt-8 p-4 bg-indigo-50 rounded-lg w-full max-w-sm">
                                    <p class="text-indigo-800 font-medium text-sm">ç´„æ¯ <span id="res-drip-sec" class="font-bold">--</span> ç§’ 1 æ»´</p>
                                </div>
                            </div>

                             <!-- è‡¨åºŠå°æç¤º -->
                             <div class="clinical-note">
                                <h4>ğŸ“š çµ¦è—¥æ³¨æ„äº‹é …</h4>
                                <ul>
                                    <li><strong>å½±éŸ¿æµé€Ÿå› ç´ ï¼š</strong> é»æ»´é«˜åº¦ã€è»Ÿé‡è™Ÿæ•¸ (Gauge)ã€è¼¸æ¶²é»æ»¯åº¦ã€ç—…äººå§¿å‹¢å‡æœƒå½±éŸ¿å¯¦éš›æµé€Ÿï¼Œéœ€å®šæ™‚å·¡è¦–ã€‚</li>
                                    <li><strong>ç²¾æº–åº¦ï¼š</strong> é‡åŠ›æ»´æ³¨èª¤å·®è¼ƒå¤§ï¼Œé«˜è­¦ç¤ºè—¥ç‰©æˆ–é›»è§£è³ªï¼ˆå¦‚ KClï¼‰å¼·çƒˆå»ºè­°ä½¿ç”¨è¼¸æ¶²å¹«æµ¦ (Infusion Pump)ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. ç‡’å‚·è¼¸æ¶² (Parkland & Brooke) - Updated -->
                <div id="tab-burn" class="tab-content hidden animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">ç‡’å‚·è¼¸æ¶²å¾©ç”¦</h2>
                        <p class="text-slate-500">æˆäºº/å…’ç«¥å°ˆå±¬å…¬å¼èˆ‡é˜²å‘†æ©Ÿåˆ¶ (Safety Interlock)ã€‚</p>
                    </header>

                    <!-- é˜²å‘†è­¦ç¤ºæ¡† -->
                    <div id="burn-safety-alert" class="danger-alert">
                        <p class="font-bold text-red-700 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            å®‰å…¨è­¦ç¤ºï¼šé«”é‡èˆ‡ç—…äººåˆ†çµ„ä¸ç¬¦ï¼
                        </p>
                        <p class="text-sm text-red-600 mt-1">é«”é‡ < 30kg è«‹å‹™å¿…é¸æ“‡ã€Œå…’ç«¥æ¨¡å¼ã€ä»¥è¨ˆç®—ç¶­æŒè¼¸æ¶²ï¼›é«”é‡ > 50kg è«‹ç¢ºèªæ˜¯å¦ç‚ºã€Œæˆäººã€ã€‚éŒ¯èª¤å…¬å¼å¯èƒ½å°è‡´ä¼‘å…‹æˆ–è‚ºæ°´è…«ã€‚</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div class="lg:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                            <!-- 1. ç—…äººåˆ†çµ„ (Trigger Safety Logic) -->
                            <div class="input-group bg-blue-50/50 p-3 rounded-lg border border-blue-100">
                                <label class="text-blue-800">1. ç—…äººåˆ†çµ„ (å¿…é¸)</label>
                                <select id="burn-type" class="input-modern cursor-pointer font-bold text-blue-900" onchange="updateBurnFormulas()">
                                    <option value="adult" selected>æˆäºº (Adult)</option>
                                    <option value="child">å…’ç«¥ (Child)</option>
                                </select>
                            </div>

                            <div class="input-group mt-4">
                                <label>2. ç—…äººé«”é‡ (Weight)</label>
                                <input type="number" id="burn-kg" class="input-modern" placeholder="kg" oninput="checkBurnSafety()">
                            </div>
                            <div class="input-group">
                                <label>3. ç‡’å‚·é¢ç© (%TBSA)</label>
                                <input type="number" id="burn-tbsa" class="input-modern" placeholder="%">
                            </div>

                            <!-- 4. å…¬å¼ (Dynamic Options) -->
                            <div class="input-group">
                                <label>4. å¾©ç”¦å…¬å¼ (Resuscitation)</label>
                                <select id="burn-formula" class="input-modern cursor-pointer">
                                    <!-- Dynamic populated by JS -->
                                </select>
                            </div>
                            
                            <!-- 5. ç¶­æŒè¼¸æ¶²å…¬å¼ (Child Only) -->
                            <div id="burn-maint-select-group" class="input-group hidden bg-blue-50/50 p-2 rounded-lg border border-blue-100">
                                <label class="text-blue-800 text-sm">5. ç¶­æŒè¼¸æ¶²å…¬å¼ (Maintenance)</label>
                                <select id="burn-maint-formula" class="input-modern cursor-pointer text-sm">
                                    <option value="421">Holliday-Segar (4-2-1 Rule)</option>
                                    <option value="100">Daily Volume (100-50-20 Rule)</option>
                                </select>
                            </div>

                            <button onclick="calculateBurn()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-orange-200 mt-2">
                                è¨ˆç®— 24h å¾©ç”¦è¨ˆç•«
                            </button>
                        </div>

                        <div class="lg:col-span-8 space-y-4">
                            <!-- è¨ˆç®—çµæœé¢æ¿ -->
                            <div class="result-card rounded-2xl p-6">
                                <!-- å¾©ç”¦è¼¸æ¶² (LR) -->
                                <div class="mb-6">
                                    <p class="text-sm font-bold text-orange-600 uppercase tracking-widest mb-2">å¾©ç”¦è¼¸æ¶² (Resuscitation Fluid) - LR</p>
                                    <div class="flex justify-between items-end border-b border-orange-200 pb-2 mb-2">
                                        <span class="text-slate-500">24hr ç¸½é‡</span>
                                        <span id="res-burn-total" class="text-2xl font-bold text-slate-800">-- mL</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-xs text-slate-400">å‰ 8 å°æ™‚é€Ÿç‡</p>
                                            <p id="res-burn-rate8" class="text-lg font-bold text-slate-700">-- mL/hr</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-slate-400">å¾Œ 16 å°æ™‚é€Ÿç‡</p>
                                            <p id="res-burn-rate16" class="text-lg font-bold text-slate-700">-- mL/hr</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¶­æŒè¼¸æ¶² (Maintenance) - Child Only -->
                                <div id="burn-maint-panel" class="hidden bg-blue-50 p-4 rounded-xl border border-blue-100">
                                    <p class="text-sm font-bold text-blue-600 uppercase tracking-widest mb-2 flex items-center gap-2">
                                        <span class="text-lg">ğŸ’§</span> ç¶­æŒè¼¸æ¶² (Maintenance) - D5LR
                                    </p>
                                    <p class="text-xs text-blue-400 mb-2">éœ€é¡å¤–çµ¦äºˆå«ç³–è¼¸æ¶²é é˜²ä½è¡€ç³–ã€‚</p>
                                    
                                    <div class="mb-2 pb-2 border-b border-blue-200/50">
                                        <p class="text-[10px] text-slate-500 uppercase font-bold">è¨ˆç®—å…¬å¼é‚è¼¯</p>
                                        <p id="res-burn-maint-logic" class="text-xs font-mono text-slate-600">--</p>
                                    </div>

                                    <div class="flex justify-between items-end">
                                        <span class="text-slate-600 font-medium">å›ºå®šé€Ÿç‡</span>
                                        <span id="res-burn-maint-rate" class="text-2xl font-bold text-blue-700">-- mL/hr</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- âš ï¸ å…¬å¼é™åˆ¶èˆ‡å®‰å…¨è­¦ç¤º -->
                            <div class="clinical-note bg-red-50 border-red-400">
                                <h4 class="text-red-700">âš ï¸ å…¬å¼é™åˆ¶èˆ‡å®‰å…¨è­¦ç¤º</h4>
                                <ul class="text-red-800">
                                    <li><strong>Modified Brooke (2 mL)ï¼š</strong> é©ç”¨æ–¼æˆäººç‡’å‚·ã€‚å„ªé»æ˜¯æ¸›å°‘è‚ºæ°´è…«èˆ‡è…¹å…§é«˜å£“é¢¨éšªï¼Œä½†å¯èƒ½å°è‡´å°¿é‡ä¸è¶³ï¼Œéœ€åš´å¯†ç›£æ¸¬ã€‚<span class="font-bold">ä¸å»ºè­°ç”¨æ–¼å…’ç«¥</span>ã€‚</li>
                                    <li><strong>Parkland (4 mL)ï¼š</strong> å‚³çµ±æ¨™æº–ï¼Œé©ç”¨æ–¼é«˜å£“é›»æ“Šå‚·ã€å¸å…¥æ€§å—†å‚·æˆ–å»¶é²å¾©ç”¦è€…ã€‚ç¼ºé»æ˜¯æ¶²é«”éè² è· (Fluid Creep) é¢¨éšªè¼ƒé«˜ã€‚</li>
                                    <li><strong>ABA Pediatric (3 mL)ï¼š</strong> ç¾åœ‹ç‡’å‚·å­¸æœƒ (ABA) æ¨è–¦å…’ç«¥èµ·å§‹åŠ‘é‡ã€‚å…’ç«¥é«”è¡¨é¢ç©å¤§ï¼Œæ•£ç†±å¿«ä¸”ä»£è¬é«˜ï¼Œ<span class="font-bold">å‹™å¿…åŠ ä¸Šå«ç³–ç¶­æŒè¼¸æ¶²</span>ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. é«˜è­¦ç¤ºè—¥ç‰©æ»´æ³¨ -->
                <div id="tab-weight" class="tab-content hidden animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">é«˜è­¦ç¤ºè—¥ç‰©æ»´æ³¨</h2>
                        <p class="text-slate-500">è¨ˆç®—è¼¸æ¶²å¹«æµ¦ (Pump) è¨­å®šé€Ÿç‡ (mcg/kg/min â†’ mL/hr)ã€‚</p>
                    </header>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div class="lg:col-span-6 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label>ç›®æ¨™åŠ‘é‡</label>
                                    <div class="relative">
                                        <input type="number" id="wd-dose" class="input-modern pr-16" placeholder="0">
                                        <span class="absolute right-3 top-3 text-xs text-slate-400">mcg/kg/min</span>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>é«”é‡</label>
                                    <div class="relative">
                                        <input type="number" id="wd-kg" class="input-modern pr-8" placeholder="0">
                                        <span class="absolute right-3 top-3 text-xs text-slate-400">kg</span>
                                    </div>
                                </div>
                            </div>
                            <div class="border-t border-slate-100 my-4 pt-4">
                                <p class="text-xs font-bold text-slate-400 mb-3">è—¥ç‰©é…æ–¹æ¿ƒåº¦</p>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="input-group">
                                        <label>è—¥ç‰©ç¸½é‡ (mg)</label>
                                        <input type="number" id="wd-mg" class="input-modern" placeholder="mg">
                                    </div>
                                    <div class="input-group">
                                        <label>ç¨€é‡‹é«”ç© (mL)</label>
                                        <input type="number" id="wd-vol" class="input-modern" placeholder="mL">
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="calculateWeightDrip()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-red-200 mt-2">
                                è¨ˆç®— Pump é€Ÿç‡
                            </button>
                        </div>

                        <div class="lg:col-span-6">
                            <div class="result-card rounded-2xl p-8 h-full flex flex-col justify-center border-l-4 border-l-red-500">
                                <div>
                                    <p class="text-sm font-bold text-slate-400 uppercase">è—¥ç‰©æ¿ƒåº¦ (Concentration)</p>
                                    <p id="res-wd-conc" class="text-2xl font-bold text-slate-700 mt-1 mb-6">-- mcg/mL</p>
                                    
                                    <p class="text-sm font-bold text-red-500 uppercase">Pump è¨­å®šé€Ÿç‡ (Rate)</p>
                                    <p id="res-wd-rate" class="text-5xl font-bold text-red-600 mt-2">--</p>
                                    <p class="text-lg text-slate-500 mt-1">mL/hr</p>
                                </div>
                                <div class="mt-8 p-3 bg-red-50 rounded text-xs text-red-700 flex gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    é«˜è­¦ç¤ºè—¥ç‰©è«‹å‹™å¿…åŸ·è¡Œé›™äººæ ¸å° (Double Check)ã€‚
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 8. æ–°å¢: é«”ä½èˆ‡è…åŠŸèƒ½ (Renal & Body Metrics) -->
                <div id="tab-renal" class="tab-content hidden animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">é«”ä½èˆ‡è…åŠŸèƒ½è©•ä¼°</h2>
                        <p class="text-slate-500">è¨ˆç®— BMI, BSA, IBW ä»¥åŠè‚Œé…¸é…æ¸…é™¤ç‡ (CCr)ã€‚</p>
                    </header>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <!-- è¼¸å…¥å€ -->
                        <div class="lg:col-span-6 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                            <h3 class="font-bold text-slate-700 mb-4 border-b pb-2">åŸºæœ¬è³‡æ–™</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label>æ€§åˆ¥</label>
                                    <select id="rb-gender" class="input-modern cursor-pointer">
                                        <option value="male">ç”·æ€§ (Male)</option>
                                        <option value="female">å¥³æ€§ (Female)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>å¹´é½¡</label>
                                    <input type="number" id="rb-age" class="input-modern" placeholder="æ­²">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="input-group">
                                    <label>èº«é«˜ (cm)</label>
                                    <input type="number" id="rb-height" class="input-modern" placeholder="cm">
                                </div>
                                <div class="input-group">
                                    <label>é«”é‡ (kg)</label>
                                    <input type="number" id="rb-weight" class="input-modern" placeholder="kg">
                                </div>
                            </div>
                            <div class="input-group">
                                <label>è¡€æ¸…è‚Œé…¸é… (Serum Cr)</label>
                                <input type="number" id="rb-scr" class="input-modern" placeholder="mg/dL">
                            </div>
                            <button onclick="calculateRenalBody()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-emerald-200 mt-2">
                                è¨ˆç®—é«”ä½èˆ‡è…åŠŸèƒ½
                            </button>
                        </div>
                        
                        <!-- çµæœå€ -->
                        <div class="lg:col-span-6 space-y-4">
                            <!-- é«”ä½çµæœ -->
                            <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                <h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-3">é«”ä½æŒ‡æ¨™ (Body Metrics)</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-xs text-slate-500">BMI</p>
                                        <p id="res-bmi" class="text-xl font-bold text-slate-800">--</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">é«”è¡¨é¢ç© (BSA)</p>
                                        <p id="res-bsa" class="text-xl font-bold text-slate-800">-- mÂ²</p>
                                    </div>
                                    <div class="col-span-2">
                                        <p class="text-xs text-slate-500">ç†æƒ³é«”é‡ (IBW)</p>
                                        <p id="res-ibw" class="text-xl font-bold text-slate-800">-- kg</p>
                                    </div>
                                </div>
                            </div>

                            <!-- è…åŠŸèƒ½çµæœ -->
                            <div class="result-card rounded-2xl p-6 relative overflow-hidden">
                                <div class="relative z-10">
                                    <p class="text-sm font-bold text-emerald-600 uppercase tracking-widest">è‚Œé…¸é…æ¸…é™¤ç‡ (C-G Eq)</p>
                                    <p id="res-ccr" class="text-4xl font-bold text-slate-800 mt-2 mb-2">--</p>
                                    <p class="text-sm text-slate-500">mL/min</p>
                                </div>
                                <div class="absolute -right-6 -top-6 w-24 h-24 bg-emerald-100 rounded-full blur-2xl opacity-60"></div>
                            </div>

                            <div class="clinical-note text-xs">
                                <h4>ğŸ“š è—¥ç‰©åŠ‘é‡èª¿æ•´åƒè€ƒ</h4>
                                <ul>
                                    <li><strong>CCr è¨ˆç®—ï¼š</strong> æ¡ç”¨ Cockcroft-Gault å…¬å¼ï¼Œé€™ä»æ˜¯å¤šæ•¸è—¥ç‰©åŸå» ä»¿å–®å»ºè­°çš„åŠ‘é‡èª¿æ•´ä¾æ“š (é eGFR)ã€‚</li>
                                    <li><strong>é«”é‡é¸ç”¨ï¼š</strong> æœ¬è¨ˆç®—æ©Ÿä½¿ç”¨ã€Œå¯¦éš›é«”é‡ã€è¨ˆç®— CCrã€‚è‹¥ç—…äººé«”é‡ > 130% IBWï¼Œéƒ¨åˆ†æ–‡ç»å»ºè­°ä½¿ç”¨èª¿æ•´é«”é‡ (AdjBW)ï¼Œè«‹ä¾è‡¨åºŠåˆ¤æ–·ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. å¹³å‡å‹•è„ˆå£“ (MAP) -->
                <div id="tab-map" class="tab-content hidden animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">å¹³å‡å‹•è„ˆå£“ (MAP)</h2>
                        <p class="text-slate-500">è©•ä¼°å™¨å®˜çŒæµçš„é‡è¦æŒ‡æ¨™ã€‚å…¬å¼: (SBP + 2Ã—DBP) Ã· 3</p>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                            <div class="input-group">
                                <label>æ”¶ç¸®å£“ (SBP)</label>
                                <input type="number" id="map-sbp" class="input-modern" placeholder="mmHg">
                            </div>
                            <div class="input-group">
                                <label>èˆ’å¼µå£“ (DBP)</label>
                                <input type="number" id="map-dbp" class="input-modern" placeholder="mmHg">
                            </div>
                            <button onclick="calculateMAP()" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-teal-200 mt-2">
                                è¨ˆç®— MAP
                            </button>
                        </div>

                        <div class="space-y-4">
                            <div class="result-card rounded-2xl p-8 flex flex-col justify-center items-center text-center">
                                <p class="text-sm font-bold text-teal-600 uppercase tracking-widest">å¹³å‡å‹•è„ˆå£“</p>
                                <p id="res-map-val" class="text-6xl font-bold text-slate-800 my-4">--</p>
                                <p class="text-slate-500">mmHg</p>
                                
                                <div id="res-map-alert" class="mt-6 px-4 py-2 rounded-full text-sm font-bold hidden">
                                    --
                                </div>
                            </div>
                            
                            <!-- è‡¨åºŠå°æç¤º -->
                             <div class="clinical-note">
                                <h4>ğŸ“š æ²»ç™‚ç›®æ¨™èˆ‡æ„ç¾©</h4>
                                <ul>
                                    <li><strong>æ•—è¡€æ€§ä¼‘å…‹ï¼š</strong> ä¾æ“š Surviving Sepsis Campaign æŒ‡å¼•ï¼Œåˆå§‹å¾©ç”¦ç›®æ¨™é€šå¸¸ç‚º MAP â‰¥ 65 mmHgã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. é ç”¢æœŸè¨ˆç®— (EDD) -->
                <div id="tab-edd" class="tab-content hidden animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">é ç”¢æœŸè¨ˆç®— (EDD)</h2>
                        <p class="text-slate-500">ä½¿ç”¨ Naegele's Rule æ¨ç®—é ç”¢æœŸèˆ‡å¦Šå¨ é€±æ•¸ã€‚</p>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                            <div class="input-group">
                                <label>æœ€å¾Œä¸€æ¬¡æœˆç¶“é¦–æ—¥ (LMP)</label>
                                <input type="date" id="edd-lmp" class="input-modern">
                            </div>
                            <div class="input-group">
                                <label>å¹³å‡æœˆç¶“é€±æœŸ (Cycle Length)</label>
                                <input type="number" id="edd-cycle" class="input-modern" value="28" placeholder="å¤©æ•¸ (é è¨­28)">
                                <p class="text-xs text-slate-400 mt-1">è‹¥ä¸ç¢ºå®šè«‹ç¶­æŒ 28 å¤©</p>
                            </div>
                            <button onclick="calculateEDD()" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-pink-200 mt-2">
                                è¨ˆç®—é ç”¢æœŸ
                            </button>
                        </div>

                        <div class="space-y-4">
                            <div class="result-card rounded-2xl p-8 flex flex-col justify-center relative overflow-hidden">
                                <div class="relative z-10">
                                    <p class="text-sm font-bold text-pink-500 uppercase tracking-widest">é ç”¢æœŸ (EDD)</p>
                                    <p id="res-edd-date" class="text-3xl font-bold text-slate-800 mt-2 mb-6">--</p>
                                    
                                    <div class="border-t border-slate-200 pt-4">
                                        <p class="text-sm font-bold text-slate-500 uppercase tracking-widest">ç›®å‰å¦Šå¨ é€±æ•¸ (GA)</p>
                                        <p id="res-edd-ga" class="text-4xl font-bold text-slate-800 mt-2">--</p>
                                    </div>
                                </div>
                                <div class="absolute -right-6 -top-6 w-32 h-32 bg-pink-100 rounded-full blur-2xl opacity-60"></div>
                            </div>
                            
                            <!-- è‡¨åºŠå°æç¤º -->
                             <div class="clinical-note">
                                <h4>ğŸ“š å­•æœŸè©•ä¼°é‡é»</h4>
                                <ul>
                                    <li><strong>Naegele's Ruleï¼š</strong> è¨ˆç®—æ–¹å¼ç‚º (LMPæœˆä»½ - 3, æ—¥æœŸ + 7)ã€‚è‹¥é€±æœŸé 28 å¤©ï¼Œæ¯å¤šä¸€å¤© EDD +1ï¼Œå°‘ä¸€å¤© EDD -1ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. æª¢é©—æ•¸å€¼ (Labs) -->
                <div id="tab-lab" class="tab-content hidden animate-fade-in">
                    <header class="mb-8">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">æª¢é©—æ•¸å€¼æ ¡æ­£</h2>
                        <p class="text-slate-500">å¸¸ç”¨ç”ŸåŒ–æ•¸å€¼æ ¡æ­£ (Ca, Na) èˆ‡é–“éš™è¨ˆç®—ã€‚</p>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Corrected Calcium -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col">
                            <h3 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2">æ ¡æ­£éˆ£ (Corrected Calcium)</h3>
                            <div class="space-y-4 flex-1">
                                <div class="input-group">
                                    <label>æ¸¬é‡éˆ£ (Measured Ca)</label>
                                    <input type="number" id="lab-ca" class="input-modern" placeholder="mg/dL">
                                </div>
                                <div class="input-group">
                                    <label>ç™½è›‹ç™½ (Albumin)</label>
                                    <input type="number" id="lab-alb" class="input-modern" placeholder="g/dL">
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-slate-50 rounded-xl text-center">
                                <p class="text-2xl font-bold text-indigo-600" id="res-lab-ca">--</p>
                                <p class="text-xs text-slate-400">mg/dL</p>
                            </div>
                            <button onclick="calculateCa()" class="w-full mt-4 bg-slate-800 text-white py-2 rounded-lg hover:bg-slate-700">è¨ˆç®—</button>
                        </div>

                        <!-- Corrected Sodium -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col">
                            <h3 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2">é«˜è¡€ç³–æ ¡æ­£éˆ‰ (Corrected Na)</h3>
                            <div class="space-y-4 flex-1">
                                <div class="input-group">
                                    <label>æ¸¬é‡éˆ‰ (Measured Na)</label>
                                    <input type="number" id="lab-na-g" class="input-modern" placeholder="mEq/L">
                                </div>
                                <div class="input-group">
                                    <label>è¡€ç³– (Glucose)</label>
                                    <input type="number" id="lab-gluc" class="input-modern" placeholder="mg/dL">
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-slate-50 rounded-xl text-center">
                                <p class="text-2xl font-bold text-indigo-600" id="res-lab-na-corr">--</p>
                                <p class="text-xs text-slate-400">mEq/L</p>
                            </div>
                            <button onclick="calculateCorrectedNa()" class="w-full mt-4 bg-slate-800 text-white py-2 rounded-lg hover:bg-slate-700">è¨ˆç®—</button>
                             <div class="mt-2 text-[10px] text-slate-400">
                                è¡€ç³–æ¯ä¸Šå‡ 100mg/dLï¼Œè¡€éˆ‰ç´„ä¸‹é™ 1.6 mEq/Lã€‚
                            </div>
                        </div>

                        <!-- Anion Gap -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col">
                            <h3 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2">é™°é›¢å­é–“éš™ (Anion Gap)</h3>
                            <div class="space-y-4 flex-1">
                                <div class="input-group">
                                    <label>éˆ‰ (Na+)</label>
                                    <input type="number" id="lab-na" class="input-modern" placeholder="mEq/L">
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="input-group">
                                        <label>æ°¯ (Cl-)</label>
                                        <input type="number" id="lab-cl" class="input-modern" placeholder="mEq/L">
                                    </div>
                                    <div class="input-group">
                                        <label>HCO3-</label>
                                        <input type="number" id="lab-hco3" class="input-modern" placeholder="mEq/L">
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-slate-50 rounded-xl text-center">
                                <p class="text-2xl font-bold text-indigo-600" id="res-lab-ag">--</p>
                                <p class="text-xs text-slate-400">mEq/L (Normal: 8-12)</p>
                            </div>
                            <button onclick="calculateAG()" class="w-full mt-4 bg-slate-800 text-white py-2 rounded-lg hover:bg-slate-700">è¨ˆç®—</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // --- æ ¸å¿ƒé‚è¼¯ ---

        // 1. I/O è¨ˆç®—
        function calculateIO() {
            const intake = parseFloat(document.getElementById('io-intake').value);
            const output = parseFloat(document.getElementById('io-output').value);
            const hours = parseFloat(document.getElementById('io-hours').value);
            
            if (isNaN(intake) || isNaN(output) || isNaN(hours) || hours <= 0) {
                alert("è«‹è¼¸å…¥å®Œæ•´çš„æœ‰æ•ˆæ•¸å€¼");
                return;
            }

            const balance = intake - output;
            const uop = output / hours;
            
            const balEl = document.getElementById('res-io-balance');
            const uopEl = document.getElementById('res-io-uop');
            const msgEl = document.getElementById('res-io-msg');

            // Balance é¡¯ç¤º
            balEl.textContent = (balance > 0 ? "+" : "") + balance;
            balEl.className = `text-4xl font-bold mt-1 ${balance > 0 ? 'text-blue-600' : (balance < 0 ? 'text-amber-500' : 'text-slate-800')}`;

            // UOP é¡¯ç¤º
            uopEl.textContent = uop.toFixed(1);
            if (uop < 30) {
                uopEl.className = "text-4xl font-bold mt-1 text-red-500";
                msgEl.innerHTML = `<span class="w-2 h-2 rounded-full bg-red-500"></span> âš  UOP éä½ (< 30 mL/hr)ï¼Œè«‹æ³¨æ„è…åŠŸèƒ½ã€‚`;
            } else {
                uopEl.className = "text-4xl font-bold mt-1 text-emerald-600";
                msgEl.innerHTML = `<span class="w-2 h-2 rounded-full bg-emerald-500"></span> å°¿é‡æ­£å¸¸ã€‚`;
            }
        }

        // 2. IV Drip
        function calculateDrip() {
            const vol = parseFloat(document.getElementById('iv-vol').value);
            const time = parseFloat(document.getElementById('iv-time').value);
            const factor = parseFloat(document.getElementById('iv-factor').value);

            if (isNaN(vol) || isNaN(time) || time <= 0) {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å€¼");
                return;
            }

            const minutes = time * 60;
            const gtts = (vol * factor) / minutes;
            const secondsPerDrop = 60 / gtts;

            document.getElementById('res-drip').textContent = Math.round(gtts);
            document.getElementById('res-drip-sec').textContent = secondsPerDrop.toFixed(1);
        }

        // --- 3. Burn (Parkland & Modified Brooke) Safety & Logic ---

        // Define formulas
        const burnFormulas = {
            adult: [
                { val: 2, text: 'Modified Brooke (2 mL Ã— kg Ã— %)' },
                { val: 4, text: 'Parkland (4 mL Ã— kg Ã— %)' }
            ],
            child: [
                { val: 3, text: 'ABA Pediatric (3 mL Ã— kg Ã— %)' },
                { val: 4, text: 'Parkland (4 mL Ã— kg Ã— %)' }
            ]
        };

        // Initialize formulas on load
        function initBurn() {
            updateBurnFormulas();
        }

        function updateBurnFormulas() {
            const type = document.getElementById('burn-type').value;
            const select = document.getElementById('burn-formula');
            
            // Save current selection value if possible
            const currentVal = select.value;
            
            // Clear existing
            select.innerHTML = '';
            
            // Populate based on type
            const options = burnFormulas[type];
            options.forEach(opt => {
                const el = document.createElement('option');
                el.value = opt.val;
                el.textContent = opt.text;
                select.appendChild(el);
            });
            
            // Toggle Maintenance Panel & Select visibility based on type
            const maintPanel = document.getElementById('burn-maint-panel');
            const maintSelectGroup = document.getElementById('burn-maint-select-group');
            
            if(type === 'child') {
                maintPanel.classList.remove('hidden');
                maintSelectGroup.classList.remove('hidden');
            } else {
                maintPanel.classList.add('hidden');
                maintSelectGroup.classList.add('hidden');
            }

            checkBurnSafety(); // Re-check safety on type change
        }

        function checkBurnSafety() {
            const type = document.getElementById('burn-type').value;
            const kg = parseFloat(document.getElementById('burn-kg').value);
            const alertBox = document.getElementById('burn-safety-alert');

            if (isNaN(kg)) {
                alertBox.style.display = 'none';
                return;
            }

            // Safety Logic (Poka-yoke)
            // Adult selected but weight < 30kg -> Warning
            // Child selected but weight > 50kg -> Warning
            if (type === 'adult' && kg < 30) {
                alertBox.style.display = 'block';
            } else if (type === 'child' && kg > 50) {
                alertBox.style.display = 'block';
            } else {
                alertBox.style.display = 'none';
            }
        }

        function calculateBurn() {
            const formulaFactor = parseFloat(document.getElementById('burn-formula').value);
            const kg = parseFloat(document.getElementById('burn-kg').value);
            const tbsa = parseFloat(document.getElementById('burn-tbsa').value);
            const type = document.getElementById('burn-type').value;

            if (isNaN(kg) || isNaN(tbsa) || kg <= 0 || tbsa <= 0) {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å€¼");
                return;
            }

            // 1. Resuscitation Fluid (LR)
            const resusTotal = formulaFactor * kg * tbsa;
            const resusHalf = resusTotal / 2;
            const rate8 = resusHalf / 8;
            const rate16 = resusHalf / 16;

            document.getElementById('res-burn-total').textContent = Math.round(resusTotal) + " mL";
            document.getElementById('res-burn-rate8').textContent = Math.round(rate8) + " mL/hr";
            document.getElementById('res-burn-rate16').textContent = Math.round(rate16) + " mL/hr";

            // 2. Maintenance Fluid (D5LR) - For Children Only
            if (type === 'child') {
                const maintFormula = document.getElementById('burn-maint-formula').value;
                let maintRate = 0;
                let logicText = "";

                if (maintFormula === "421") {
                    // 4-2-1 Rule (Hourly Rate)
                    if (kg <= 10) {
                        maintRate = 4 * kg;
                        logicText = `4 Ã— ${kg} = ${maintRate}`;
                    } else if (kg <= 20) {
                        maintRate = 40 + 2 * (kg - 10);
                        logicText = `40 + 2 Ã— (${kg} - 10) = ${maintRate}`;
                    } else {
                        maintRate = 60 + 1 * (kg - 20);
                        logicText = `60 + 1 Ã— (${kg} - 20) = ${maintRate}`;
                    }
                } else if (maintFormula === "100") {
                    // 100-50-20 Rule (Daily Volume / 24)
                    let dailyVol = 0;
                    if (kg <= 10) {
                        dailyVol = 100 * kg;
                        logicText = `(100 Ã— ${kg}) / 24`;
                    } else if (kg <= 20) {
                        dailyVol = 1000 + 50 * (kg - 10);
                        logicText = `(1000 + 50 Ã— (${kg} - 10)) / 24`;
                    } else {
                        dailyVol = 1500 + 20 * (kg - 20);
                        logicText = `(1500 + 20 Ã— (${kg} - 20)) / 24`;
                    }
                    maintRate = dailyVol / 24;
                }
                
                document.getElementById('res-burn-maint-logic').textContent = logicText;
                document.getElementById('res-burn-maint-rate').textContent = Math.round(maintRate) + " mL/hr";
            }
        }

        // 4. Weight Based Drip
        function calculateWeightDrip() {
            const dose = parseFloat(document.getElementById('wd-dose').value);
            const kg = parseFloat(document.getElementById('wd-kg').value);
            const mg = parseFloat(document.getElementById('wd-mg').value);
            const vol = parseFloat(document.getElementById('wd-vol').value);

            if (isNaN(dose) || isNaN(kg) || isNaN(mg) || isNaN(vol) || vol === 0) {
                alert("è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼");
                return;
            }

            const concMcgMl = (mg * 1000) / vol;
            const demandMcgHr = dose * kg * 60;
            const rate = demandMcgHr / concMcgMl;

            document.getElementById('res-wd-conc').textContent = concMcgMl.toFixed(1) + " mcg/mL";
            document.getElementById('res-wd-rate').textContent = rate.toFixed(1);
        }

        // 5. Renal & Body Metrics (New)
        function calculateRenalBody() {
            const gender = document.getElementById('rb-gender').value;
            const age = parseFloat(document.getElementById('rb-age').value);
            const height = parseFloat(document.getElementById('rb-height').value);
            const weight = parseFloat(document.getElementById('rb-weight').value);
            const scr = parseFloat(document.getElementById('rb-scr').value);
            
            // Check essential inputs for Body Metrics
            if (isNaN(height) || isNaN(weight)) {
                alert("è«‹è‡³å°‘è¼¸å…¥èº«é«˜èˆ‡é«”é‡");
                return;
            }

            // 1. BMI: kg / (m^2)
            const heightM = height / 100;
            const bmi = weight / (heightM * heightM);
            document.getElementById('res-bmi').textContent = bmi.toFixed(1);

            // 2. BSA (Mosteller): sqrt( kg * cm / 3600 )
            const bsa = Math.sqrt((weight * height) / 3600);
            document.getElementById('res-bsa').textContent = bsa.toFixed(2) + " mÂ²";

            // 3. IBW (Robinson formula)
            // Male: 52 + 0.75 * (height - 152.4)
            // Female: 49 + 0.67 * (height - 152.4)
            // Only valid if height > 152.4 cm (5 feet) roughly
            let ibw = 0;
            if (height > 152.4) {
                 const overHeight = height - 152.4;
                 if (gender === 'male') {
                     ibw = 52 + (0.75 * overHeight);
                 } else {
                     ibw = 49 + (0.67 * overHeight);
                 }
                 document.getElementById('res-ibw').textContent = ibw.toFixed(1) + " kg";
            } else {
                 document.getElementById('res-ibw').textContent = "N/A (<152cm)";
            }

            // 4. CCr (Cockcroft-Gault)
            // ((140 - age) * weight) / (72 * SCr) (* 0.85 if female)
            if (!isNaN(age) && !isNaN(scr) && scr > 0) {
                let ccr = ((140 - age) * weight) / (72 * scr);
                if (gender === 'female') {
                    ccr *= 0.85;
                }
                document.getElementById('res-ccr').textContent = ccr.toFixed(1);
            } else {
                document.getElementById('res-ccr').textContent = "--";
            }
        }

        // 6. MAP
        function calculateMAP() {
            const sbp = parseFloat(document.getElementById('map-sbp').value);
            const dbp = parseFloat(document.getElementById('map-dbp').value);

            if (isNaN(sbp) || isNaN(dbp)) {
                alert("è«‹è¼¸å…¥è¡€å£“æ•¸å€¼");
                return;
            }

            const map = (sbp + 2 * dbp) / 3;
            const el = document.getElementById('res-map-val');
            const alertEl = document.getElementById('res-map-alert');

            el.textContent = Math.round(map);
            
            alertEl.classList.remove('hidden', 'bg-red-100', 'text-red-600', 'bg-teal-100', 'text-teal-600');
            
            if (map < 65) {
                alertEl.textContent = "âš  MAP < 65 mmHgï¼Œå™¨å®˜çŒæµå¯èƒ½ä¸è¶³";
                alertEl.classList.add('bg-red-100', 'text-red-600', 'inline-block');
            } else {
                alertEl.textContent = "âœ” çŒæµå£“åŠ›å¯æ¥å—";
                alertEl.classList.add('bg-teal-100', 'text-teal-600', 'inline-block');
            }
        }
        
        // 7. EDD Calculation
        function calculateEDD() {
            const lmpInput = document.getElementById('edd-lmp').value;
            const cycleDays = parseInt(document.getElementById('edd-cycle').value) || 28;

            if (!lmpInput) {
                alert("è«‹é¸æ“‡æœ€å¾Œä¸€æ¬¡æœˆç¶“æ—¥æœŸ (LMP)");
                return;
            }

            const lmpDate = new Date(lmpInput);
            const eddDate = new Date(lmpDate);
            eddDate.setFullYear(eddDate.getFullYear() + 1);
            eddDate.setMonth(eddDate.getMonth() - 3);
            eddDate.setDate(eddDate.getDate() + 7);
            
            const adjustment = cycleDays - 28;
            eddDate.setDate(eddDate.getDate() + adjustment);

            const today = new Date();
            const diffTime = today - lmpDate; 
            const diffDaysTotal = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            let gaText = "--";
            if (diffDaysTotal >= 0) {
                 const weeks = Math.floor(diffDaysTotal / 7);
                 const days = diffDaysTotal % 7;
                 gaText = `${weeks} é€± ${days} å¤©`;
            } else {
                 gaText = "å°šæœªæ‡·å­• (LMP åœ¨æœªä¾†)";
            }

            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
            document.getElementById('res-edd-date').textContent = eddDate.toLocaleDateString('zh-TW', options);
            document.getElementById('res-edd-ga').textContent = gaText;
        }

        // 8. Labs
        function calculateCa() {
            const ca = parseFloat(document.getElementById('lab-ca').value);
            const alb = parseFloat(document.getElementById('lab-alb').value);

            if (isNaN(ca) || isNaN(alb)) return;
            const corrCa = ca + 0.8 * (4.0 - alb);
            document.getElementById('res-lab-ca').textContent = corrCa.toFixed(2);
        }

        function calculateCorrectedNa() {
            const na = parseFloat(document.getElementById('lab-na-g').value);
            const gluc = parseFloat(document.getElementById('lab-gluc').value);

            if (isNaN(na) || isNaN(gluc)) return;
            // Formula: Measured Na + 1.6 * ((Glucose - 100) / 100)
            // Only apply if Glucose > 100
            if (gluc > 100) {
                const corrNa = na + 1.6 * ((gluc - 100) / 100);
                document.getElementById('res-lab-na-corr').textContent = corrNa.toFixed(1);
            } else {
                document.getElementById('res-lab-na-corr').textContent = na.toFixed(1);
            }
        }

        function calculateAG() {
            const na = parseFloat(document.getElementById('lab-na').value);
            const cl = parseFloat(document.getElementById('lab-cl').value);
            const hco3 = parseFloat(document.getElementById('lab-hco3').value);

            if (isNaN(na) || isNaN(cl) || isNaN(hco3)) return;
            const ag = na - (cl + hco3);
            document.getElementById('res-lab-ag').textContent = ag.toFixed(1);
        }

        // --- ä»‹é¢åˆ‡æ›é‚è¼¯ ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
            });
            document.getElementById('tab-' + tabId).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
            });
            const activeNav = document.getElementById('nav-' + tabId);
            if(activeNav) activeNav.classList.add('active');
        }

        window.onload = () => {
            switchTab('io');
            initBurn(); // Init Burn options
        }

    </script>
</body>
</html>
